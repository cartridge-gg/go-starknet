package provider

import (
	"context"
	"encoding/json"
	"testing"

	"github.com/google/go-cmp/cmp"
)

const blockDump = `{"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "timestamp": 1641308207, "status": "ACCEPTED_ON_L2", "transactions": [{"contract_address": "0xef97a5e7e5cf26c6e44fefdc1a9733df84a726d918de6793560453cb8ec1ee", "entry_point_type": "EXTERNAL", "calldata": ["2702538570254786720984691102364794313085096883131402862233682678387253553627", "2", "1385474741617458705986008799961512504473415932479651710568892050698729910081", "1587024124098737177745880808134221715071181315640448103806725315496118242520"], "signature": [], "transaction_hash": "0x3129c8a7fc02db38718b252817df81a94b2f356837e66a16787b8ac7386c627", "entry_point_selector": "0x317eb442b72a9fae758d4fb26830ed0d9f31c8e7da4dbff4e8c59ea6a158e7f", "type": "INVOKE_FUNCTION"}, {"contract_address": "0x5a1c72d04a6bb4614ba1ad5408e455702a997c291c651776e228e16d05c96c0", "entry_point_type": "EXTERNAL", "calldata": ["1255175082362537419853904155975930940067765029127967939063589058155716621375", "1730451322352175698494706181905649389390569048075770236443234037657863305871"], "signature": [], "transaction_hash": "0x1459eadeb5b187c70e5b57c78b2c91cd0ae469834cb88e7cbfce78ab4349289", "entry_point_selector": "0x19a35a6e95cb7a3318dbb244f20975a1cd8587cc6b5259f15f61d7beb7ee43b", "type": "INVOKE_FUNCTION"}, {"contract_address": "0x6e09dfc5b8e08ed1b7f2c59f7985433cf0412d5150b81438035f20a92228fc0", "entry_point_type": "EXTERNAL", "calldata": ["2997654770182471460954719312950884680023265536996318019468425755755830882165", "1329909728320632088402217562277154056711815095720684343816173432540100887380", "3", "3110741211734810958017750127489596665863074558637137390322887040888119398336", "1000000000000000000000", "0", "0"], "signature": ["2304605437075717915250122715041651022487217079079270310794451421407045215122", "1898265732120975703421768869668556633492823246426488253064504150909108578786"], "transaction_hash": "0xf47c31b40d56776826a229811e852416d4cf65282279e4d3338108384cb054", "entry_point_selector": "0x240060cdb34fcc260f41eac7474ee1d7c80b7e3607daff9ac67c7ea2ebb1c44", "type": "INVOKE_FUNCTION"}, {"contract_address": "0x7d4c368d9a23d21b163fed5720217c7d318ccd8c464e09a5b5db31cca34ae5c", "entry_point_type": "EXTERNAL", "calldata": ["1369066430471698344751147495881731330051652282832500522916154665653431122207", "1737806834891659957988373423388711239891733974125793472992920296585311412419", "2", "337576098872032474630191429827122480294461637160180354297242573484660558438", "3193769254695630266316996889868117490234436530385686547079476456134573011980"], "signature": [], "transaction_hash": "0x55150ce8c7153d2fba9109d0f5817a418b795a64c2fe66cec8740d72b9dacb8", "entry_point_selector": "0x27c3334165536f239cfd400ed956eabff55fc60de4fb56728b6a4f6b87db01c", "type": "INVOKE_FUNCTION"}, {"constructor_calldata": ["2745369965294193998448201272387583199461086202044007713564642158518038664390", "0"], "contract_address": "0x3e8cae8045464626d762b238079919b3c1a2add1c4025b3c10cd998fa1f280a", "contract_address_salt": "0x355d06a2af5ece02460600ff8cc83e86811195f9606cd3fe2392df6b4740f6c", "transaction_hash": "0x75fe43596b893141f0c19ddcda76c18c0d9bd73d62c00ab09ef76ba726e9d07", "type": "DEPLOY"}, {"contract_address": "0x7d4c368d9a23d21b163fed5720217c7d318ccd8c464e09a5b5db31cca34ae5c", "entry_point_type": "EXTERNAL", "calldata": ["1752342153364772336762125995932080582477877507123750231161745027591108888502", "2", "604767451850730588717096754806868885278359509821462678104708173565665699610", "508120802261863212851695997210914461784707651358172005644578152752387706374"], "signature": [], "transaction_hash": "0x25d6dda2a88545f1371c4cdec0cfe5c6893e291dca2a2a677ecb77f9f3daa9", "entry_point_selector": "0x317eb442b72a9fae758d4fb26830ed0d9f31c8e7da4dbff4e8c59ea6a158e7f", "type": "INVOKE_FUNCTION"}, {"contract_address": "0x7d4c368d9a23d21b163fed5720217c7d318ccd8c464e09a5b5db31cca34ae5c", "entry_point_type": "EXTERNAL", "calldata": ["1752342153364772336762125995932080582477877507123750231161745027591108888502", "2", "604767451850730588717096754806868885278359509821462678104708173565665699610", "3207113492790593007609335645077054759922276723357869536430514132215559169644"], "signature": [], "transaction_hash": "0x2b0f7483125eac660f8ab7d53b301e6873805ece1f8c5f9c90ab75d9b52eb9b", "entry_point_selector": "0x317eb442b72a9fae758d4fb26830ed0d9f31c8e7da4dbff4e8c59ea6a158e7f", "type": "INVOKE_FUNCTION"}, {"constructor_calldata": ["2270263258008483191515624554770398678506259431804949583386540115687910172622", "0"], "contract_address": "0x3cc9eeb996ad84b32b779d98f9cde8070fcecfe2a2448222a1bdd657f5c5835", "contract_address_salt": "0x6d4d4f5c0fa6006310a01c9b010023da7e3e8dcb1f436c3fa4c23e2d816f35a", "transaction_hash": "0x783baddfadc69dfff959bde1eb1d32bdbee79a5417b2c8d0d016d62b1f52702", "type": "DEPLOY"}, {"constructor_calldata": ["2745369965294193998448201272387583199461086202044007713564642158518038664390", "0"], "contract_address": "0x3f1d3f3a1689c3afbfed46428b11c4c1f1082a6ecbdcca1e209c868b29213a5", "contract_address_salt": "0x1764abe8276be3b3b580b05fdff763cdb0ce3572c23a339ccb65c7b887fd8ec", "transaction_hash": "0x7cbf32fe0aa2de983eeb920e547340149356167bd5c9fc3d800984a3f27719", "type": "DEPLOY"}, {"contract_address": "0x306dd383efd53bb5b8498d500c89acabbc7b462a8322e5054ea60a57bc7391f", "entry_point_type": "EXTERNAL", "calldata": ["1007904289485113710219819921383284972331370425311"], "signature": [], "transaction_hash": "0x39287e1084367dc6ac27096ba5f0332457b0420a76b6df28f0b2a10d8e66e51", "entry_point_selector": "0x12ead94ae9d3f9d2bdb6b847cf255f1f398193a1f88884a0ae8e18f24a037b6", "type": "INVOKE_FUNCTION"}, {"contract_address": "0x500c77cf6d4bb4421b2427f60027208845b67959310f7d295c97f1dffc8a4b8", "entry_point_type": "EXTERNAL", "calldata": ["2997654770182471460954719312950884680023265536996318019468425755755830882165", "1329909728320632088402217562277154056711815095720684343816173432540100887380", "3", "2262941059467066407826172679635078347272929121776472823976698709741213885624", "10000000000000000000", "0", "1"], "signature": ["427157896168473586251494060309909318059371774783882230181287923109971434793", "2876492411505073004095707587704140674979362782403520484373048070532158094592"], "transaction_hash": "0x48c797430cedd597b2a21b3be5b4ea67c6f3ef32850f93c77054efaa4a5ce5b", "entry_point_selector": "0x240060cdb34fcc260f41eac7474ee1d7c80b7e3607daff9ac67c7ea2ebb1c44", "type": "INVOKE_FUNCTION"}, {"contract_address": "0x2c667675b5cf4b912c31b9963273da0b165696144d39f50e50ab7b0d105343f", "entry_point_type": "EXTERNAL", "calldata": ["911497576289035233439741414039224521645220034264703858433819484227487060145", "2", "214350248391963319138369826428008841428759225700394867750383468373113793656", "3197649938481747920706969557411307681178748676470159748731601631756773178449"], "signature": [], "transaction_hash": "0x3d1af2da52a2d51fdc4c3f1d3565215cfc8096907f2a750bb631933f0d382f2", "entry_point_selector": "0x317eb442b72a9fae758d4fb26830ed0d9f31c8e7da4dbff4e8c59ea6a158e7f", "type": "INVOKE_FUNCTION"}, {"contract_address": "0x2c667675b5cf4b912c31b9963273da0b165696144d39f50e50ab7b0d105343f", "entry_point_type": "EXTERNAL", "calldata": ["911497576289035233439741414039224521645220034264703858433819484227487060145", "2", "214350248391963319138369826428008841428759225700394867750383468373113793656", "1676407475433222307531936174679348556034224951650769398900615640947581811714"], "signature": [], "transaction_hash": "0x23b50551332f39a17b461a9a8c6baa1d6bfbb5ffbaaa022d81f8d26639bc5a2", "entry_point_selector": "0x317eb442b72a9fae758d4fb26830ed0d9f31c8e7da4dbff4e8c59ea6a158e7f", "type": "INVOKE_FUNCTION"}, {"constructor_calldata": ["1471644161615100166095652914427555139261906098523915188623793301537195014506", "0"], "contract_address": "0x8511d723328021da9e121049cd8a7d6f751b71948222d00f1e093a3cc39d9c", "contract_address_salt": "0x3a7734220abb859ae352708a103c3f1c62d53749fea898ba562b607268a4ce8", "transaction_hash": "0x3c853b1b2451b98cf5ed42039b42ac11e0636d7b6fa6c4f364f2f1d7439361b", "type": "DEPLOY"}, {"constructor_calldata": ["2006443924546252746532347651104378247988794350260301887386128549783943322387", "0"], "contract_address": "0x476fef31a02b64686b5f148204d74af5e6051d93d8a91367715f0d46e58d468", "contract_address_salt": "0x3a2a2bee955b5dd467c0e9ef72b2ddbf07544fafc93b3b019731067dac90bed", "transaction_hash": "0x7c18bc9224f50b7aff737cee1464e422f8535e4399a838f9ddc6e572d58d2e5", "type": "DEPLOY"}, {"constructor_calldata": ["2808455019534083479276904338295006725536300962824012577040123575200192660356", "0"], "contract_address": "0x66799c559e6756b421b1f54f1654741ecdf5ca9ae9dccb08cc67a64d7a8c020", "contract_address_salt": "0x35862b7079fb96d6e2fd5cbaa17202da3ab39f3fff7be20cd1eca329d824d37", "transaction_hash": "0x2c9910dcd60bf5581089de7df66ee43c6557edba73aff199cf2d6f441a4e814", "type": "DEPLOY"}, {"contract_address": "0x2c667675b5cf4b912c31b9963273da0b165696144d39f50e50ab7b0d105343f", "entry_point_type": "EXTERNAL", "calldata": ["2988102118064669854066281301460533361143617452758378410531530127314264976626", "0"], "signature": [], "transaction_hash": "0x1176e0c4757d039e529020c5f279fc282e5f66f3c9fb220ea7193d4ad272911", "entry_point_selector": "0x218f305395474a84a39307fa5297be118fe17bf65e27ac5e2de6617baa44c64", "type": "INVOKE_FUNCTION"}, {"constructor_calldata": ["244808465155812903242645603603209385481915464762505176301620658375968391944", "0"], "contract_address": "0x7dad93c9a9d1abf111fe68ef3cf78287342f6658d0dc5daa5ed874e1a24ada0", "contract_address_salt": "0x6d1afdcda0244e768f30dcd2924b9267d46befa2986692bd8448db550c84260", "transaction_hash": "0x157b9399c2ce59eae128e4bfb6b1846394197c042dc90b13f3af9ecaffd6f22", "type": "DEPLOY"}, {"constructor_calldata": ["244808465155812903242645603603209385481915464762505176301620658375968391944", "0"], "contract_address": "0x81f1a5d7a07fabb8ea4afee3ad56b8c208a4c22b286ac0469cfae1b9e22093", "contract_address_salt": "0x42bf27451152c4d8a55570c327db74c7eb76caceefcfcb372e2390b1512f6a6", "transaction_hash": "0x36f51192ea1cc4eeee2fa0ad9af8a147d55e7b561fcfa8148c00e951c9df94e", "type": "DEPLOY"}, {"contract_address": "0x26704e810b71eb2b99081e5093a01773f69b37163f8256c59dbd323bbab8b3d", "entry_point_type": "EXTERNAL", "calldata": ["2997654770182471460954719312950884680023265536996318019468425755755830882165", "1329909728320632088402217562277154056711815095720684343816173432540100887380", "3", "1086644808292048134107134757058009361393820425772757521779863424964944956221", "1000000000000000000000", "0", "0"], "signature": ["2624462889305163041535477652824376920771700600796484323994636651237400740799", "1159601377385057436007767188985818160384069704534186283200528616638142189836"], "transaction_hash": "0x460c647079d51300fa578ae674d80f74febbb957143929c49599f86707a3850", "entry_point_selector": "0x240060cdb34fcc260f41eac7474ee1d7c80b7e3607daff9ac67c7ea2ebb1c44", "type": "INVOKE_FUNCTION"}, {"contract_address": "0x5b3f22a6023af9e2b9d68f96cd16826acc2b4281b3d3ebbe7e0c79935154339", "entry_point_type": "EXTERNAL", "calldata": ["1070280855342795308888022485676839698852744217552"], "signature": [], "transaction_hash": "0x394eaed0629c6084f81dbe2caab5989253af28b6230dc547c487304d39a7a64", "entry_point_selector": "0x12ead94ae9d3f9d2bdb6b847cf255f1f398193a1f88884a0ae8e18f24a037b6", "type": "INVOKE_FUNCTION"}, {"constructor_calldata": ["1879231605403143509492714202689118036303148461364753634739318469827955183406", "0"], "contract_address": "0x4b48b75f816c3796119533861f4c55a7a9abbd9de3903d36361aa8275b476b3", "contract_address_salt": "0x38c21ef7fce785859c5e9877d913fb547e50492f720c517fbd4703c9459d155", "transaction_hash": "0xf6323ef2a64cefbc3f65d8acdc3361bab274a9ac246af43a5dd0a30c884f45", "type": "DEPLOY"}, {"constructor_calldata": ["972023021889513499568847818269009696177324608297927649541183191022196723164", "0"], "contract_address": "0x4a73123238ce8210a3a90871d4407432e6c5e0e0bc934fd73616209005cbd64", "contract_address_salt": "0x364d74149f146e4e5f546eeeb65bfa8900e0f8a2ddeedcb373c3fce2046d6f", "transaction_hash": "0x790d79a9b6c5c1c5af3c7b99830ceae872a371dbb10e9a593872c63dc92ee91", "type": "DEPLOY"}, {"constructor_calldata": ["1388084158805087816142711926630409224508094952684630262985827892006076442744", "0"], "contract_address": "0x1c3465ccd26d9ad805ff2ebd32ae31bd4fdae3c642c07ec72bd3021ae149c25", "contract_address_salt": "0x75b54fe0c02aecc5e120532e58c7df08f182e0de441d8bf7a22e9ccd801c030", "transaction_hash": "0x5ac39817b0d086ff07b7123616f3c2cef5fba08dd8598bfb9125c75633ab430", "type": "DEPLOY"}, {"constructor_calldata": ["1483300295987922767470489944748341128690748384590565367642589193932563979109", "1835227978845724674036622105909233285610430872322999213914496751488238636268"], "contract_address": "0x32d44304b9238acdb44eb3f5feaa4e329d36c1d28905f563bdfe28c4f6e0b16", "contract_address_salt": "0x434aba41507000ae477c24d26291391ff1d828956a0fcb941c112b9fb85306a", "transaction_hash": "0x11efff186a39e5670a0d1be422ea770dcc940c9e3ee23821719b1cf7bb9817", "type": "DEPLOY"}, {"constructor_calldata": ["3429810184952462273818023108118608089178343320086975817639064127528122624939", "0"], "contract_address": "0x367130623119ad084e7ca38ee6e11184d940feed98306ec6a354cdee26a516d", "contract_address_salt": "0x2f69b53a91659ebf25cb1623e028f54435e7c2c9e26cc9cf381440edc258519", "transaction_hash": "0x2ddb5912f616e61dac5e337e4c964016af4ed4e4da788df22bcbf8730c38351", "type": "DEPLOY"}, {"constructor_calldata": ["166169771720659741084099539979027848194779667484265863429096414771270438300", "0"], "contract_address": "0x28287394e8e1eb959b46df3ff92f59dde191758996fe9361c154cd16f5ca615", "contract_address_salt": "0xd7012d10706e1f77a8956bb2040ef7183cb74c987e2b5e66c3298d6e3b45d", "transaction_hash": "0x4d89701f503b29270c406c57fd0068a102ffcd27952e564bebea74c02255355", "type": "DEPLOY"}, {"contract_address": "0x27c2ddb5ecec66dde0ea6bffbdd6cb5bd8abbf9796aecc6a2a3721727ad7feb", "entry_point_type": "EXTERNAL", "calldata": ["3499944600403423045596478842973440920488495831487291124662996196747392569475", "1115389529164513768047120842725913109279815352434774956742239039323846159749"], "signature": [], "transaction_hash": "0x6405e05241c05b222ac8cd61fa15bf6c902d5b66732c6c9d1da243e7db7c0a4", "entry_point_selector": "0x3d7905601c217734671143d457f0db37f7f8883112abd34b92c4abfeafde0c3", "type": "INVOKE_FUNCTION"}, {"contract_address": "0x33ec72b2af3874441942c60bfea70845139dd8948f1268c5ba2dc626112d034", "entry_point_type": "EXTERNAL", "calldata": ["423323084993276700683067442568643789247895349497480217703091883119628698094", "1464559046839038251379963598692977430331780780893387921730228876588781967642", "1", "0"], "signature": [], "transaction_hash": "0xdd708e4c9548dea1fb548a6e0d8a0d32720f16c39dd7230b82a9d1a30f9f44", "entry_point_selector": "0x27c3334165536f239cfd400ed956eabff55fc60de4fb56728b6a4f6b87db01c", "type": "INVOKE_FUNCTION"}, {"constructor_calldata": ["220999909398567110488893797796752866658721038456409241843314686023515753664", "0"], "contract_address": "0x3afb6625d196e8c8c8c262750b978ae7c2cc45778282164f3dccea4dc14246f", "contract_address_salt": "0x5388330b9be417287487c4beb3ba4995c79e14300ab85d62c3c853ca029d4fb", "transaction_hash": "0x7b5bc99f7558815998501388945363292728d3c16011358ef0b328d6b3740df", "type": "DEPLOY"}, {"contract_address": "0x278f066a431cd7a6b389849ca13bfd384156461c8fd44cc4cc16a454ba6539a", "entry_point_type": "EXTERNAL", "calldata": ["2997654770182471460954719312950884680023265536996318019468425755755830882165", "1329909728320632088402217562277154056711815095720684343816173432540100887380", "3", "1118306531269432136175988698718924308968364531276498977020734058759784387482", "1000000000000000000000", "0", "0"], "signature": ["766310806700447241676486119933675696224155421460104403699598800268718046427", "464693030421412881802770870622316777563652674387451325542028683849715421573"], "transaction_hash": "0x3b248423011f5537609b378f412b7d5e63fb59583c1bb0ac661d2473529e0fa", "entry_point_selector": "0x240060cdb34fcc260f41eac7474ee1d7c80b7e3607daff9ac67c7ea2ebb1c44", "type": "INVOKE_FUNCTION"}, {"contract_address": "0x7d4c368d9a23d21b163fed5720217c7d318ccd8c464e09a5b5db31cca34ae5c", "entry_point_type": "EXTERNAL", "calldata": ["420673836993098576232985561026294787631445239964307650465526099209891548550", "0"], "signature": [], "transaction_hash": "0x5667fde1a043dc2f9c99f3cbdc4e6c8f73ddb2f05eed86324dc34f308b0ed9d", "entry_point_selector": "0x218f305395474a84a39307fa5297be118fe17bf65e27ac5e2de6617baa44c64", "type": "INVOKE_FUNCTION"}, {"contract_address": "0x426e1f1592d7e078dc7bd61b9ebbf434897c07c4c615045e0c68db9ef048219", "entry_point_type": "EXTERNAL", "calldata": ["2997654770182471460954719312950884680023265536996318019468425755755830882165", "1329909728320632088402217562277154056711815095720684343816173432540100887380", "3", "1877950982461327224555008454784324093193910545226514217778537708830884921881", "1000000000000000000000", "0", "0"], "signature": ["1574318510893141709821406842534510012414502630428431278019865509920296901805", "3337203541000435579260866897141978117645865438653177297610346670008353280800"], "transaction_hash": "0x12806d735347899225013eab7ae5ef1f29b15093d0334cf3e5920587beca1ef", "entry_point_selector": "0x240060cdb34fcc260f41eac7474ee1d7c80b7e3607daff9ac67c7ea2ebb1c44", "type": "INVOKE_FUNCTION"}, {"contract_address": "0x6eeefce63bc81620e375c7501cb7b5aecdf9fb99aa5ec25886b8b854c4293cb", "entry_point_type": "EXTERNAL", "calldata": ["2997654770182471460954719312950884680023265536996318019468425755755830882165", "1329909728320632088402217562277154056711815095720684343816173432540100887380", "3", "3136041774546213678351283565957744013647469404218744855555628226611855397835", "1000000000000000000000", "0", "0"], "signature": ["2431220894610634219103765075814737105065344771927858947642226884539623687597", "2493106639905190081580451796327007488515294918114254851959484796897977282099"], "transaction_hash": "0x4a00cfb5164127a18b17283c20085504ac3848fbd965584d163eccdea741fb6", "entry_point_selector": "0x240060cdb34fcc260f41eac7474ee1d7c80b7e3607daff9ac67c7ea2ebb1c44", "type": "INVOKE_FUNCTION"}], "parent_block_hash": "0x70c4383dd6dbb4be2e0b2141f5cb59cc0e3cf8848a01d6dc85e65b1f0547a46", "transaction_receipts": [{"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 0, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 22, "builtin_instance_counter": {"pedersen_builtin": 2, "range_check_builtin": 7, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 165}, "transaction_hash": "0x3129c8a7fc02db38718b252817df81a94b2f356837e66a16787b8ac7386c627", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 1, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 178}, "transaction_hash": "0x1459eadeb5b187c70e5b57c78b2c91cd0ae469834cb88e7cbfce78ab4349289", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 2, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 22, "builtin_instance_counter": {"pedersen_builtin": 12, "range_check_builtin": 14, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 1, "ec_op_builtin": 0}, "n_steps": 752}, "transaction_hash": "0xf47c31b40d56776826a229811e852416d4cf65282279e4d3338108384cb054", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 3, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 2, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 1, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 65}, "transaction_hash": "0x55150ce8c7153d2fba9109d0f5817a418b795a64c2fe66cec8740d72b9dacb8", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 4, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x75fe43596b893141f0c19ddcda76c18c0d9bd73d62c00ab09ef76ba726e9d07", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 5, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 22, "builtin_instance_counter": {"pedersen_builtin": 2, "range_check_builtin": 7, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 165}, "transaction_hash": "0x25d6dda2a88545f1371c4cdec0cfe5c6893e291dca2a2a677ecb77f9f3daa9", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 6, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 22, "builtin_instance_counter": {"pedersen_builtin": 2, "range_check_builtin": 7, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 165}, "transaction_hash": "0x2b0f7483125eac660f8ab7d53b301e6873805ece1f8c5f9c90ab75d9b52eb9b", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 7, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x783baddfadc69dfff959bde1eb1d32bdbee79a5417b2c8d0d016d62b1f52702", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 8, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x7cbf32fe0aa2de983eeb920e547340149356167bd5c9fc3d800984a3f27719", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 9, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 31}, "transaction_hash": "0x39287e1084367dc6ac27096ba5f0332457b0420a76b6df28f0b2a10d8e66e51", "l2_to_l1_messages": [{"from_address": "0x306dd383efd53bb5b8498d500c89acabbc7b462a8322e5054ea60a57bc7391f", "to_address": "0xB08bfDd025f426c2c59cF2D2339FC7B4bD622bDF", "payload": ["12", "34"]}], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 10, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 20, "builtin_instance_counter": {"pedersen_builtin": 12, "range_check_builtin": 14, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 1, "ec_op_builtin": 0}, "n_steps": 756}, "transaction_hash": "0x48c797430cedd597b2a21b3be5b4ea67c6f3ef32850f93c77054efaa4a5ce5b", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 11, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 20, "builtin_instance_counter": {"pedersen_builtin": 2, "range_check_builtin": 7, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 169}, "transaction_hash": "0x3d1af2da52a2d51fdc4c3f1d3565215cfc8096907f2a750bb631933f0d382f2", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 12, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 20, "builtin_instance_counter": {"pedersen_builtin": 2, "range_check_builtin": 7, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 169}, "transaction_hash": "0x23b50551332f39a17b461a9a8c6baa1d6bfbb5ffbaaa022d81f8d26639bc5a2", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 13, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x3c853b1b2451b98cf5ed42039b42ac11e0636d7b6fa6c4f364f2f1d7439361b", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 14, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x7c18bc9224f50b7aff737cee1464e422f8535e4399a838f9ddc6e572d58d2e5", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 15, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x2c9910dcd60bf5581089de7df66ee43c6557edba73aff199cf2d6f441a4e814", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 16, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 238}, "transaction_hash": "0x1176e0c4757d039e529020c5f279fc282e5f66f3c9fb220ea7193d4ad272911", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 17, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x157b9399c2ce59eae128e4bfb6b1846394197c042dc90b13f3af9ecaffd6f22", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 18, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x36f51192ea1cc4eeee2fa0ad9af8a147d55e7b561fcfa8148c00e951c9df94e", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 19, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 20, "builtin_instance_counter": {"pedersen_builtin": 12, "range_check_builtin": 14, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 1, "ec_op_builtin": 0}, "n_steps": 756}, "transaction_hash": "0x460c647079d51300fa578ae674d80f74febbb957143929c49599f86707a3850", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 20, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 31}, "transaction_hash": "0x394eaed0629c6084f81dbe2caab5989253af28b6230dc547c487304d39a7a64", "l2_to_l1_messages": [{"from_address": "0x5b3f22a6023af9e2b9d68f96cd16826acc2b4281b3d3ebbe7e0c79935154339", "to_address": "0xBB790DaC1F2b4C8BC6fC14f13FCAcA60Bb4f43d0", "payload": ["12", "34"]}], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 21, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0xf6323ef2a64cefbc3f65d8acdc3361bab274a9ac246af43a5dd0a30c884f45", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 22, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x790d79a9b6c5c1c5af3c7b99830ceae872a371dbb10e9a593872c63dc92ee91", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 23, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x5ac39817b0d086ff07b7123616f3c2cef5fba08dd8598bfb9125c75633ab430", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 24, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 29}, "transaction_hash": "0x11efff186a39e5670a0d1be422ea770dcc940c9e3ee23821719b1cf7bb9817", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 25, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x2ddb5912f616e61dac5e337e4c964016af4ed4e4da788df22bcbf8730c38351", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 26, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x4d89701f503b29270c406c57fd0068a102ffcd27952e564bebea74c02255355", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 27, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 25}, "transaction_hash": "0x6405e05241c05b222ac8cd61fa15bf6c902d5b66732c6c9d1da243e7db7c0a4", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 28, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 1, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 1, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 63}, "transaction_hash": "0xdd708e4c9548dea1fb548a6e0d8a0d32720f16c39dd7230b82a9d1a30f9f44", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 29, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 68}, "transaction_hash": "0x7b5bc99f7558815998501388945363292728d3c16011358ef0b328d6b3740df", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 30, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 22, "builtin_instance_counter": {"pedersen_builtin": 12, "range_check_builtin": 14, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 1, "ec_op_builtin": 0}, "n_steps": 752}, "transaction_hash": "0x3b248423011f5537609b378f412b7d5e63fb59583c1bb0ac661d2473529e0fa", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 31, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 0, "builtin_instance_counter": {"pedersen_builtin": 0, "range_check_builtin": 0, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 0, "ec_op_builtin": 0}, "n_steps": 238}, "transaction_hash": "0x5667fde1a043dc2f9c99f3cbdc4e6c8f73ddb2f05eed86324dc34f308b0ed9d", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 32, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 20, "builtin_instance_counter": {"pedersen_builtin": 12, "range_check_builtin": 14, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 1, "ec_op_builtin": 0}, "n_steps": 756}, "transaction_hash": "0x12806d735347899225013eab7ae5ef1f29b15093d0334cf3e5920587beca1ef", "l2_to_l1_messages": [], "block_number": 582}, {"block_hash": "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9", "transaction_index": 33, "status": "ACCEPTED_ON_L2", "execution_resources": {"n_memory_holes": 20, "builtin_instance_counter": {"pedersen_builtin": 12, "range_check_builtin": 14, "bitwise_builtin": 0, "output_builtin": 0, "ecdsa_builtin": 1, "ec_op_builtin": 0}, "n_steps": 756}, "transaction_hash": "0x4a00cfb5164127a18b17283c20085504ac3848fbd965584d163eccdea741fb6", "l2_to_l1_messages": [], "block_number": 582}], "block_number": 582, "state_root": "06655e1a05d0a95fa5c9297d70f9e03b1ba629f7c4470f3c3ccdae1c2aca30a9"}`

func TestProvider_Block(t *testing.T) {
	var want *Block
	if err := json.Unmarshal([]byte(blockDump), &want); err != nil {
		t.Fatalf("unmarshalling block: %v", err)
	}

	for _, tc := range []struct {
		opts *BlockOptions
	}{{
		opts: nil,
	}, {
		opts: &BlockOptions{BlockNumber: 582},
	}, {
		opts: &BlockOptions{BlockHash: "0x182d83f0ed972e97fa529be0088e20b5a7cb32e3bba0d164d668147713e79f9"},
	}} {
		ctx := context.Background()
		p := NewProvider("https://alpha-mainnet.starknet.io")
		got, err := p.GetBlock(ctx, tc.opts)
		if err != nil {
			t.Fatalf("getting block: %v", err)
		}

		if tc.opts != nil {
			if diff := cmp.Diff(want, got, nil); diff != "" {
				t.Errorf("Block diff mismatch (-want +got):\n%s", diff)
			}
		}
	}
}
